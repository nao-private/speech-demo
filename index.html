<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å®ãã˜è²©å£²ã‚µãƒãƒ¼ãƒˆ</title>
</head>
<body>
  <h1>ğŸ« å®ãã˜è²©å£²ã‚µãƒãƒ¼ãƒˆ</h1>

  <label for="langSelect">
    è¨€èªã‚’é¸æŠï¼Please select language:
  </label>
  <select id="langSelect" disabled>
    <option value="ja-JP">æ—¥æœ¬èª</option>
    <option value="en-US">English (US)</option>
  </select>
  <button id="startBtn" disabled>
    ğŸ™ï¸ ç™ºè©±é–‹å§‹
  </button>

  <p id="result">èªè­˜çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</p>

  <script>
    // éŸ³å£°åˆæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    function speak(text, lang, onend) {
      const utt = new SpeechSynthesisUtterance(text);
      utt.lang = lang;
      utt.onend = onend;
      speechSynthesis.speak(utt);
    }

    // ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ã‚’é€£ç¶šå†ç”Ÿ
    function playGuidance() {
      speak("ã„ã‚‰ã£ã—ã‚ƒã„ã¾ã›ã€‚", "ja-JP", () => {
        speak("Can I help you?", "en-US", () => {
          speak(
            "è¨€èªã‚’é¸æŠã—ã¦ç™ºè©±ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚",
            "ja-JP",
            () => {
              speak(
                "Please select language and start speaking..",
                "en-US",
                enableUI
              );
            }
          );
        });
      });
    }

    // ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹å®Œäº†å¾Œã«UIã‚’æœ‰åŠ¹åŒ–
    function enableUI() {
      document.getElementById("langSelect").disabled = false;
      document.getElementById("startBtn").disabled = false;
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ã§ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹é–‹å§‹
    window.addEventListener("load", playGuidance);

    // Web Speech API è¨­å®š
    const SpeechRecognition =
      window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = new SpeechRecognition();
    recognition.interimResults = false;
    recognition.maxAlternatives = 1;

    recognition.onresult = event => {
      const text = event.results[0][0].transcript;
      document.getElementById("result").textContent =
        "èªè­˜çµæœ: " + text;
    };

    recognition.onerror = event => {
      document.getElementById("result").textContent =
        "ã‚¨ãƒ©ãƒ¼: " + event.error;
    };

    // ç™ºè©±é–‹å§‹ãƒœã‚¿ãƒ³å‡¦ç†
    document
      .getElementById("startBtn")
      .addEventListener("click", () => {
        const lang = document.getElementById("langSelect").value;
        recognition.lang = lang;
        recognition.start();
        document.getElementById("result").textContent =
          "ğŸ§ èãå–ã‚Šä¸­â€¦ï¼ˆ" + lang + "ï¼‰";
      });
  </script>
</body>
</html>
